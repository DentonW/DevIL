PROJECT(DevIL)

FILE(GLOB DevIL_SRCS src/*.c src/*.cpp)
FILE(GLOB DevIL_INC include/*.h ../include/IL/config.h ../include/IL/devil_internal_exports.h ../include/IL/il.h)
FILE(GLOB DevIL_RSRC)
FILE(GLOB DevIL_TXT)

INCLUDE_DIRECTORIES(

	${DevIL_SOURCE_DIR}/include
	${DevIL_SOURCE_DIR}/../include
)

#SET(DevIL_INC ${DEVIL_INCS} ${DEVIL_SRCS})

SET(LIBRARY_OUTPUT_PATH		${DEVIL_LIB_DEST_DIR}	)

#
# for windows add the .def and .rc files to the source list
#
IF(WIN32)
	ADD_DEFINITIONS(-DIL_USE_PRAGMA_LIBS)
	IF(BUILD_SHARED_LIBS)
		#ADD_DEFINITIONS(-DIL_DLL -DMNG_DLL -DMNG_USE_DLL -DJPEGDLL)
		ADD_DEFINITIONS(-DIL_DLL -DJPEGSTATIC)
		SET(DevIL_SRCS ${DevIL_SRCS} msvc/il.def)
		SET(DevIL_RSRC ${DevIL_RSRC} "msvc/resources/IL Logo.ico" msvc/IL.rc)
		SET(DevIL_TXT ${DevIL_TXT} ../AUTHORS ../ChangeLog ../CREDITS ../libraries.txt ../MSVC++.txt ../README.unix ../README.win ../TODO)
#		SET(CMAKE_SHARED_LINKER_FLAGS "${CMAKE_SHARED_LINKER_FLAGS} /NODEFAULTLIB:msvcrt.lib ")
		SET(CMAKE_C_FLAGS_RELEASE "/MT /O2")
	ELSE(BUILD_SHARED_LIBS)
		ADD_DEFINITIONS(-DIL_STATIC_LIB -DJPEGSTATIC)
	ENDIF(BUILD_SHARED_LIBS)
ENDIF(WIN32)

SOURCE_GROUP("Source Files" FILES src/*.c src/*.cpp)
SOURCE_GROUP("Header Files" FILES ${DevIL_INC} )
SOURCE_GROUP("Resource Files" FILES ${DevIL_RSRC} )
SOURCE_GROUP("Text Files" FILES ${DevIL_TXT} )

IF(BUILD_SHARED_LIBS)
    ADD_LIBRARY(DevIL SHARED ${DevIL_SRCS} ${DevIL_INC} ${DevIL_RSRC} ${DevIL_TXT})
ELSE(BUILD_SHARED_LIBS)
    ADD_LIBRARY(DevIL ${DevIL_SRCS} ${DevIL_INC} ${DevIL_RSRC} ${DevIL_TXT})
ENDIF(BUILD_SHARED_LIBS)



# include and link external libs
if(NOT IL_NO_LCMS)
    include_directories( ${LCMS_INCLUDE_DIR} )
    target_link_libraries( DevIL ${LCMS_LIBRARIES} )
endif(NOT IL_NO_LCMS)


INCLUDE_DIRECTORIES(
    ${PNG_INCLUDE_DIRS}
    ${TIFF_INCLUDE_DIR}
    ${JPEG_INCLUDE_DIR}
    ${JASPER_INCLUDE_DIR} 
    ${LCMS_INCLUDE_DIRS}
    ${OPENEXR_INCLUDE_DIR}
    ${NVTT_INCLUDE_DIR}
)


#TARGET_LINK_LIBRARIES(
#    DevIL
    #    ${PNG_LIBRARIES}
    #    ${JPEG_LIBRARIES}
    #${TIFF_LIBRARIES}
    #${JASPER_LIBRARIES}
    #${LCMS_LIBRARIES}
    #${OPENEXR_LIBRARIES}
    #${NVTT_LIBRARY}
    #)


install (TARGETS DevIL
    ARCHIVE DESTINATION lib
    LIBRARY DESTINATION lib
    RUNTIME DESTINATION bin
)
install (FILES ../include/IL/il.h DESTINATION include/IL)
